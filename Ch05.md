# 05 트랜잭션과 잠금

## 5.1 트랜잭션
- 논리적인 작업 셋이 100% 적용되거나 아무것도 적용되지 않아야 함을 보장

### 5.1.1 MySQL에서의 트랜잭션

### 5.1.2 주의사항
- 트랜잭션의 범위는 최소화해야 한다.

## 5.2 MySQL 엔진의 잠금

### 5.2.1 글로벌 락
- 서버 전체
- 백업 락

### 5.2.2 테이블 락
- 명시적 락
- 묵시적 락

### 5.2.3 네임드 락
- 임의의 문자열에 대한 잠금 설정
- 동일 데이터를 변경하거나 참조하는 프로그램끼리 분류하여 네임드 락을 걸고 쿼리 실행
- MySQL 8.0 부터는 네임드 락을 중첩 사용 가능

### 5.2.4 메타데이터 락
- 데이터베이스 객체의 이름이나 구조 변경 시 획득하는 잠금

## 5.3 InnoDB 스토리지 엔진 잠금
- 레코드 기반 잠금
- 최근 버전에서는 여러 모니터링 방법 추가

### 5.3.1 InnoDB 스토리지 엔진의 잠금
- 레코드 락
- 갭(GAP) 락

#### 5.3.1.1 레코드 락
- 레코드 자체만을 잠금
- MySQL은 인덱스의 레코드를 잠금
- 보조 인덱스의 경우 넥스트 키 락 / 갭 락
- PK 또는 유니크 인덱스의 경우 레코드 락

#### 5.3.1.2 갭 락
- 레코드와 바로 인접한 레코드 사이의 간격만을 잠금

#### 5.3.1.3 넥스트 키 락
- STATEMENT 포맷의 바이너리 로그를 사용하는 경우 REPEATABLE READ 격리 수준 사용해야 함
- 바이너리 로그에 기록되는 쿼리가 레플리카 서버에서 실행될 때 소스 서버에서 만들어 낸 결과와 동일한 결과를 만들어내도록 보장하는 것이 주 목적
- 가능하면 바이너리 로그 포맷을 ROW 형태로 바꾸기
  - MySQL 8.0 에서는 기본 설정

#### 5.3.1.4 자동 증가 락
- AUTO_INCREMENT 에 대한 락
- INSERT, REPLACE

### 5.3.2 인덱스와 잠금
- 인덱스를 사용하면서 접근한 레코드 모두를 잠금
- 그러므로 인덱스 설계가 중요

### 5.3.3 레코드 수준의 잠금 확인 및 해제

## 5.4 MySQL의 격리 수준
- DIRTY READ
- NON-REPEATABLE READ
- PHANTOM READ

### 5.4.1 READ UNCOMMITTED
- DIRTY READ

### 5.4.2 READ COMMITTED
- NON-REPEATABLE READ

### 5.4.3 REPEATABLE READ
- PHANTOM READ

### 5.4.4 SERIALIZABLE
